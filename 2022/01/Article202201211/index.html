<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Fulequn"><meta name="keywords" content=""><meta name="description" content="无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（6）——代码实现  参考连接： [1] Wang Y , Fang W , Ding Y , et al. Computation offloading optimization for UAV-assisted mobile edge computing: a deep deterministic policy gradient"><meta property="og:type" content="article"><meta property="og:title" content="无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（6）——代码实现"><meta property="og:url" content="https://fulequn.github.io/2022/01/Article202201211/index.html"><meta property="og:site_name" content="FuLeQun&#39;s Blog"><meta property="og:description" content="无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（6）——代码实现  参考连接： [1] Wang Y , Fang W , Ding Y , et al. Computation offloading optimization for UAV-assisted mobile edge computing: a deep deterministic policy gradient"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://raw.githubusercontent.com/fulequn/oss_img/master/img221/202201211736297.png"><meta property="article:published_time" content="2022-01-21T04:58:30.000Z"><meta property="article:modified_time" content="2024-05-30T00:16:38.000Z"><meta property="article:author" content="Fulequn"><meta property="article:tag" content="论文"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://raw.githubusercontent.com/fulequn/oss_img/master/img221/202201211736297.png"><title>无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（6）——代码实现 - FuLeQun&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"fulequn.github.io",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:60,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},gtag:null,tajs:null},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 7.2.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>FuLeQun&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（6）——代码实现"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-01-21 12:58" pubdate>2022年1月21日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i>3.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i>32 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（6）——代码实现</h1><div class="markdown-body"><h1 id="无人机辅助移动边缘计算的计算卸载优化一种深度确定性策略梯度方法6代码实现"><a class="markdownIt-Anchor" href="#无人机辅助移动边缘计算的计算卸载优化一种深度确定性策略梯度方法6代码实现"></a> 无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（6）——代码实现</h1><blockquote><p>参考连接：</p><p>[1] Wang Y , Fang W , Ding Y , et al. Computation offloading optimization for UAV-assisted mobile edge computing: a deep deterministic policy gradient approach[J]. Wireless Networks, 2021:1-16.doi：<a target="_blank" rel="noopener" href="https://doi.org/10.1007/s11276-021-02632-z">https://doi.org/10.1007/s11276-021-02632-z</a></p><p><a target="_blank" rel="noopener" href="https://morvanzhou.github.io/tutorials/">https://morvanzhou.github.io/tutorials/</a></p><p><a target="_blank" rel="noopener" href="https://github.com/fangvv/UAV-DDPG/blob/main/DDPG/DDPG_without_behavior_noise/ddpg_algo.py">https://github.com/fangvv/UAV-DDPG/blob/main/DDPG/DDPG_without_behavior_noise/ddpg_algo.py</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43835470/article/details/120881273">https://blog.csdn.net/weixin_43835470/article/details/120881273</a></p></blockquote><h2 id="6-代码实现"><a class="markdownIt-Anchor" href="#6-代码实现"></a> 6 代码实现</h2><p>本部分主要包括 Actor Critc，DDPG，DQN，Edge_only，Local_only 算法的基本实现思路，具体细节不予展示。</p><h3 id="61-问题环境"><a class="markdownIt-Anchor" href="#61-问题环境"></a> 6.1 问题环境</h3><p>问题环境主要包括了环境的各种状态 s 、无人机 uav 相关参数、用户 ue 相关参数和一些影响变量。其主要功能是模拟整个实验环境。主要动作包括了无人机飞行、无人机运算、用户移动和用户本地运算。</p><h4 id="611-参数设计"><a class="markdownIt-Anchor" href="#611-参数设计"></a> 6.1.1 参数设计</h4><p>参数包括了场地大小，无人机位置，带宽，噪声功率等参数，包括模拟实验中的所有参数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#################### uav ####################</span><br>height = ground_length = ground_width = <span class="hljs-number">100</span>  <span class="hljs-comment"># 场地长宽均为100m，UAV飞行高度也是</span><br>sum_task_size = <span class="hljs-number">60</span> * <span class="hljs-number">1048576</span>  <span class="hljs-comment"># 总计算任务60 Mbits</span><br>loc_uav = [<span class="hljs-number">50</span>, <span class="hljs-number">50</span>]  <span class="hljs-comment">#无人机的初始位置</span><br><br>bandwidth_nums = <span class="hljs-number">1</span><br><span class="hljs-comment"># 1MHz = 10^6Hz</span><br>B = bandwidth_nums * <span class="hljs-number">10</span> ** <span class="hljs-number">6</span>  <span class="hljs-comment"># 带宽1MHz</span><br>p_noisy_los = <span class="hljs-number">10</span> ** (-<span class="hljs-number">13</span>)  <span class="hljs-comment"># 噪声功率-100dBm    ****</span><br>p_noisy_nlos = <span class="hljs-number">10</span> ** (-<span class="hljs-number">11</span>)  <span class="hljs-comment"># 噪声功率-80dBm    ****</span><br>flight_speed = <span class="hljs-number">50.</span>  <span class="hljs-comment"># 飞行速度50m/s</span><br>f_ue = <span class="hljs-number">6e8</span>  <span class="hljs-comment"># UE的计算频率0.6GHz</span><br>f_uav = <span class="hljs-number">12e8</span>  <span class="hljs-comment"># UAV的计算频率1.2GHz</span><br>r = <span class="hljs-number">10</span> ** (-<span class="hljs-number">27</span>)  <span class="hljs-comment"># 芯片结构对cpu处理的影响因子</span><br>s = <span class="hljs-number">1000</span>  <span class="hljs-comment"># 单位bit处理所需cpu圈数1000</span><br>p_uplink = <span class="hljs-number">0.1</span>  <span class="hljs-comment"># 上行链路传输功率0.1W</span><br><span class="hljs-comment"># alpha0 = -30  # 距离为1m时的参考信道增益-30dB</span><br>alpha0 = <span class="hljs-number">1e-5</span>  <span class="hljs-comment"># 距离为1m时的参考信道增益-50dB = 1e-5   ****</span><br>T = <span class="hljs-number">200</span>  <span class="hljs-comment"># 周期200s</span><br>delta_t = <span class="hljs-number">5</span>  <span class="hljs-comment"># 1s飞行, 后4s用于悬停计算</span><br>slot_num = <span class="hljs-built_in">int</span>(T / delta_t)  <span class="hljs-comment"># 40个间隔</span><br>m_uav = <span class="hljs-number">9.65</span>  <span class="hljs-comment"># uav质量/kg</span><br>e_battery_uav = <span class="hljs-number">500000</span>  <span class="hljs-comment"># uav电池电量: 500kJ. ref: Mobile Edge Computing via a UAV-Mounted Cloudlet: Optimization of Bit Allocation and Path Planning</span><br><br><span class="hljs-comment">#################### ues ####################</span><br>M = <span class="hljs-number">4</span>  <span class="hljs-comment"># UE数量</span><br>block_flag_list = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, M)  <span class="hljs-comment"># 4个ue，ue的遮挡情况</span><br>loc_ue_list = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">101</span>, size=[M, <span class="hljs-number">2</span>])  <span class="hljs-comment"># 位置信息:x在0-100随机</span><br><span class="hljs-comment"># task_list = np.random.randint(1048576, 2097153, M)    # 随机计算任务1~2Mbits</span><br>task_list = np.random.randint(<span class="hljs-number">1572864</span>, <span class="hljs-number">2097153</span>, M)  <span class="hljs-comment"># 随机计算任务1.5~2Mbits</span><br><span class="hljs-comment"># ue位置转移概率</span><br><span class="hljs-comment"># 0:位置不变; 1:x+1,y; 2:x,y+1; 3:x-1,y; 4:x,y-1</span><br><span class="hljs-comment"># 60%概率原地不动，10%概率向上下左右</span><br>loc_ue_trans_pro = np.array([[<span class="hljs-number">.6</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>],<br>                             [<span class="hljs-number">.6</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>],<br>                             [<span class="hljs-number">.6</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>],<br>                             [<span class="hljs-number">.6</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>, <span class="hljs-number">.1</span>]])<br><br>action_bound = [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]  <span class="hljs-comment"># 对应tahn激活函数</span><br>action_dim = <span class="hljs-number">4</span>  <span class="hljs-comment"># 第一位表示服务的ue id;中间两位表示飞行角度和距离；后1位表示目前服务于UE的卸载率</span><br>state_dim = <span class="hljs-number">4</span> + M * <span class="hljs-number">4</span>  <span class="hljs-comment"># uav 剩余电量, uav 位置, 剩余总任务大小, 所有ue 位置, 所有ue 任务大小, 所有ue 遮挡情况</span><br></code></pre></td></tr></table></figure><h4 id="612-初始化部分"><a class="markdownIt-Anchor" href="#612-初始化部分"></a> 6.1.2 初始化部分</h4><p>初始化包括 uav 剩余电量, uav 位置, 剩余总任务大小, 所有 ue 位置, 所有 ue 任务大小, 所有 ue 遮挡情况。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        初始化环境</span><br><span class="hljs-string">        包括uav 剩余电量, uav 位置, 剩余总任务大小, 所有ue 位置, 所有ue 任务大小, 所有ue 遮挡情况</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Returns</span><br><span class="hljs-string">        -------</span><br><span class="hljs-string">        None.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment"># uav battery remain, uav loc, remaining sum task size, all ue loc, all ue task size, all ue block_flag</span><br>    self.start_state = np.append(self.e_battery_uav, self.loc_uav)<br>    self.start_state = np.append(self.start_state, self.sum_task_size)<br>    self.start_state = np.append(self.start_state, np.ravel(self.loc_ue_list))<br>    self.start_state = np.append(self.start_state, self.task_list)<br>    self.start_state = np.append(self.start_state, self.block_flag_list)<br>    self.state = self.start_state<br></code></pre></td></tr></table></figure><h4 id="613-重置"><a class="markdownIt-Anchor" href="#613-重置"></a> 6.1.3 重置</h4><p>由于实验是划分时间段进行的，涉及到每个步骤执行后的重置。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    重置环境</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns</span><br><span class="hljs-string">    -------</span><br><span class="hljs-string">    所有的环境信息</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    self.reset_env()<br>    <span class="hljs-comment"># uav battery remain, uav loc, remaining sum task size, all ue loc, all ue task size, all ue block_flag</span><br>    self.state = np.append(self.e_battery_uav, self.loc_uav)<br>    self.state = np.append(self.state, self.sum_task_size)<br>    self.state = np.append(self.state, np.ravel(self.loc_ue_list))<br>    self.state = np.append(self.state, self.task_list)<br>    self.state = np.append(self.state, self.block_flag_list)<br>    <span class="hljs-keyword">return</span> self._get_obs()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reset_env</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    将所有的值设置为默认值</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns</span><br><span class="hljs-string">    -------</span><br><span class="hljs-string">    None.</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    self.sum_task_size = <span class="hljs-number">100</span> * <span class="hljs-number">1048576</span>  <span class="hljs-comment"># 总计算任务60 Mbits</span><br>    self.e_battery_uav = <span class="hljs-number">500000</span>  <span class="hljs-comment"># uav电池电量: 500kJ</span><br>    self.loc_uav = [<span class="hljs-number">50</span>, <span class="hljs-number">50</span>]<br>    self.loc_ue_list = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">101</span>, size=[self.M, <span class="hljs-number">2</span>])  <span class="hljs-comment"># 位置信息:x在0-100随机</span><br>    self.reset_step()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reset_step</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    随机初始化ue 的计算任务和遮挡情况</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns</span><br><span class="hljs-string">    -------</span><br><span class="hljs-string">    None.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    self.task_list = np.random.randint(<span class="hljs-number">2621440</span>, <span class="hljs-number">3145729</span>, self.M)  <span class="hljs-comment"># 随机计算任务1.5~2Mbits -&gt; 1.5~2 2~2.5 2.5~3 3~3.5 3.5~4</span><br>    self.block_flag_list = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, self.M)  <span class="hljs-comment"># 4个ue，ue的遮挡情况</span><br></code></pre></td></tr></table></figure><h4 id="614-每段时间动作"><a class="markdownIt-Anchor" href="#614-每段时间动作"></a> 6.1.4 每段时间动作</h4><p>在每个时间片段中进行的动作包括了选择用户，无人机飞行，计算任务，算出最大处理时延几个部分。</p><p>选择用户的时候可以随机选择用户，也可以类似DQN中根据对应的动作选择用户。</p><p>无人机飞行时需要计算飞行后的位置以及飞行时的能量消耗。</p><p>计算任务的时候需要考虑特殊情况，如计算任务已经完成，那么实验立刻终止，不进行后续步骤；最后一步的计算任务总量与我们规定的总任务量不一致，那么重置任务大小使其满足总计算任务量；无人机飞行时飞出场地，需要重新进行该步然后进行惩罚；以及无人机的电量不足以飞行或者计算，那么就将无人机所有电量都用完后，再进行下一片段。</p><p>计算最大处理时延后需要更新我们的奖惩，同时考虑用户移动。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self</span>):  <span class="hljs-comment"># 0: 选择服务的ue编号 ; 1: 方向theta; 2: 距离d; 3: offloading ratio</span><br>    step_redo = <span class="hljs-literal">False</span>  <span class="hljs-comment">#是否重做该步</span><br>    is_terminal = <span class="hljs-literal">False</span>  <span class="hljs-comment">#是否终止</span><br>    ue_id = np.random.randint(<span class="hljs-number">0</span>, self.M) <span class="hljs-comment">#随机选择一个用户</span><br><br>    theta = <span class="hljs-number">0</span>  <span class="hljs-comment"># 角度</span><br>    offloading_ratio = <span class="hljs-number">0</span>  <span class="hljs-comment"># ue卸载率</span><br>    task_size = self.task_list[ue_id]  <span class="hljs-comment">#获取该用户的计算任务</span><br>    block_flag = self.block_flag_list[ue_id]  <span class="hljs-comment">#获取该用户的遮挡情况</span><br><br>    <span class="hljs-comment"># 飞行距离</span><br>    dis_fly = <span class="hljs-number">0</span>  <span class="hljs-comment"># 1s飞行距离</span><br>    <span class="hljs-comment"># 飞行能耗</span><br>    <span class="hljs-comment"># delta_t：5s（1s飞行，4s计算）  m_uav：uav质量</span><br>    e_fly = (dis_fly / (self.delta_t * <span class="hljs-number">0.5</span>)) ** <span class="hljs-number">2</span> * self.m_uav * (<br>            self.delta_t * <span class="hljs-number">0.5</span>) * <span class="hljs-number">0.5</span>  <span class="hljs-comment"># ref: Mobile Edge Computing via a UAV-Mounted Cloudlet: Optimization of Bit Allocation and Path Planning</span><br>    <span class="hljs-comment"># ref：通过无人机装载的云计算的移动边缘计算:位分配和路径规划的优化</span><br>    <br>    <span class="hljs-comment"># UAV飞行后的位置</span><br>    dx_uav = dis_fly * math.cos(theta)<br>    dy_uav = dis_fly * math.sin(theta)<br>    loc_uav_after_fly_x = self.loc_uav[<span class="hljs-number">0</span>] + dx_uav<br>    loc_uav_after_fly_y = self.loc_uav[<span class="hljs-number">1</span>] + dy_uav<br><br>    <span class="hljs-comment"># 服务器计算耗能</span><br>    <span class="hljs-comment"># f_uav:UAV的计算频率  s：单位bit处理所需cpu圈数</span><br>    t_server = offloading_ratio * task_size / (self.f_uav / self.s)  <span class="hljs-comment"># 在UAV边缘服务器上计算时延</span><br>    <span class="hljs-comment"># r:芯片结构对cpu处理的影响因子</span><br>    e_server = self.r * self.f_uav ** <span class="hljs-number">3</span> * t_server  <span class="hljs-comment"># 在UAV边缘服务器上计算耗能</span><br><br>    <span class="hljs-comment"># 计算任务全部完成</span><br>    <span class="hljs-keyword">if</span> self.sum_task_size == <span class="hljs-number">0</span>:  <br>        is_terminal = <span class="hljs-literal">True</span><br>        <span class="hljs-comment"># file_name = &#x27;output.txt&#x27;</span><br>        <span class="hljs-comment"># with open(file_name, &#x27;a&#x27;) as file_obj:</span><br>        <span class="hljs-comment">#     file_obj.write(&quot;\n======== This episode is done ========&quot;)  # 本episode结束</span><br>        reward = <span class="hljs-number">0</span><br>    <span class="hljs-comment"># 最后一步计算任务和ue的计算任务不匹配</span><br>    <span class="hljs-keyword">elif</span> self.sum_task_size - self.task_list[ue_id] &lt; <span class="hljs-number">0</span>:  <br>        <span class="hljs-comment"># 将最后一步计算任务改成总计算任务的剩余量</span><br>        self.task_list = np.ones(self.M) * self.sum_task_size<br>        reward = <span class="hljs-number">0</span><br>        step_redo = <span class="hljs-literal">True</span><br>    <span class="hljs-comment"># uav位置不对</span><br>    <span class="hljs-keyword">elif</span> loc_uav_after_fly_x &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> loc_uav_after_fly_x &gt; self.ground_width \<br>        <span class="hljs-keyword">or</span> loc_uav_after_fly_y &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> loc_uav_after_fly_y &gt; self.ground_length:<br>        reward = -<span class="hljs-number">100</span><br>        step_redo = <span class="hljs-literal">True</span><br>    <span class="hljs-comment"># uav电量不能支持飞行</span><br>    <span class="hljs-keyword">elif</span> self.e_battery_uav &lt; e_fly:  <br>        reward = -<span class="hljs-number">100</span><br>    <span class="hljs-comment"># uav电量不能支持计算</span><br>    <span class="hljs-keyword">elif</span> self.e_battery_uav - e_fly &lt; e_server: <br>        reward = -<span class="hljs-number">100</span><br>    <span class="hljs-comment"># 电量支持飞行,且计算任务合理,且计算任务能在剩余电量内计算</span><br>    <span class="hljs-keyword">else</span>:  <br>        delay = self.com_delay(self.loc_ue_list[ue_id], np.array([loc_uav_after_fly_x, loc_uav_after_fly_y]),<br>                               offloading_ratio, task_size, block_flag)  <span class="hljs-comment"># 计算delay</span><br>        reward = delay  <span class="hljs-comment">#reward设置为时延</span><br>        <span class="hljs-comment"># 更新下一时刻状态</span><br>        self.e_battery_uav = self.e_battery_uav - e_fly - e_server  <span class="hljs-comment"># uav 剩余电量</span><br>        self.sum_task_size -= self.task_list[ue_id]  <span class="hljs-comment"># 剩余任务量</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.M):  <span class="hljs-comment"># ue随机移动</span><br>            tmp = np.random.rand()<br>            <span class="hljs-keyword">if</span> <span class="hljs-number">0.6</span> &lt; tmp &lt;= <span class="hljs-number">0.7</span>:<br>                self.loc_ue_list[i] += [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">elif</span> <span class="hljs-number">0.7</span> &lt; tmp &lt;= <span class="hljs-number">0.8</span>:<br>                self.loc_ue_list[i] += [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">elif</span> <span class="hljs-number">0.8</span> &lt; tmp &lt;= <span class="hljs-number">0.9</span>:<br>                self.loc_ue_list[i] += [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">elif</span> <span class="hljs-number">0.9</span> &lt; tmp &lt;= <span class="hljs-number">1</span>:<br>                self.loc_ue_list[i] += [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">else</span>:<br>                self.loc_ue_list[i] += [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br>            <span class="hljs-comment"># np.clip是一个截取函数，用于截取数组中小于或者大于某值的部分，并使得被截取部分等于固定值。</span><br>            <span class="hljs-comment"># np.clip(a, a_min, a_max, out=None):</span><br>            <span class="hljs-comment"># a：输入矩阵；a_min：被限定的最小值，所有比a_min小的数都会强制变为a_min；</span><br>            <span class="hljs-comment"># a_max：被限定的最大值，所有比a_max大的数都会强制变为a_max；out：可以指定输出矩阵的对象，shape与a相同</span><br>            <span class="hljs-comment"># 限定了用户的位置</span><br>            np.clip(self.loc_ue_list[i], <span class="hljs-number">0</span>, <span class="hljs-number">100</span>)<br>        <span class="hljs-comment"># self.task_list = np.random.randint(1048576, 2097153, self.M)  # ue随机计算任务1~2Mbits</span><br>        <span class="hljs-comment"># 随机初始化ue 的计算任务和遮挡情况</span><br>        self.reset_step()<br><br>    <span class="hljs-keyword">return</span> reward, is_terminal, step_redo<br></code></pre></td></tr></table></figure><h4 id="615-计算最大处理时延"><a class="markdownIt-Anchor" href="#615-计算最大处理时延"></a> 6.1.5 计算最大处理时延</h4><p>根据用户位置，无人机位置，ue卸载率，ue的计算任务，ue的遮挡情况这些参数来计算出最大处理时延。</p><p>参照下列公式：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>max</mi><mo>⁡</mo><mrow><mo fence="true">{</mo><msub><mi>t</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>t</mi><mrow><mi>U</mi><mi>A</mi><mi>V</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>t</mi><mrow><mi>t</mi><mi>r</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex">\max \left\{t_{l o c a l, k}(i), t_{U A V, k}(i)+t_{t r, k}(i)\right\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-.286108em"></span><span class="mop">max</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">{</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.01968em">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:.01968em">l</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.10903em">U</span><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:.22222em">V</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0">}</span></span></span></span></span></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">com_delay</span>(<span class="hljs-params">self, loc_ue, loc_uav, offloading_ratio, task_size, block_flag</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    计算花费</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Parameters</span><br><span class="hljs-string">    ----------</span><br><span class="hljs-string">    loc_ue : 用户位置</span><br><span class="hljs-string">    loc_uav : 无人机位置</span><br><span class="hljs-string">    offloading_ratio : ue卸载率</span><br><span class="hljs-string">    task_size : ue的计算任务</span><br><span class="hljs-string">    block_flag : ue的遮挡情况</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns</span><br><span class="hljs-string">    -------</span><br><span class="hljs-string">    时延</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment"># 获取uav与ue之间的距离</span><br>    dx = loc_uav[<span class="hljs-number">0</span>] - loc_ue[<span class="hljs-number">0</span>]<br>    dy = loc_uav[<span class="hljs-number">1</span>] - loc_ue[<span class="hljs-number">1</span>]<br>    dh = self.height<br>    dist_uav_ue = np.sqrt(dx * dx + dy * dy + dh * dh)<br>    <br>    <span class="hljs-comment"># 噪声功率</span><br>    p_noise = self.p_noisy_los<br>    <span class="hljs-keyword">if</span> block_flag == <span class="hljs-number">1</span>:<br>        p_noise = self.p_noisy_nlos<br>    g_uav_ue = <span class="hljs-built_in">abs</span>(self.alpha0 / dist_uav_ue ** <span class="hljs-number">2</span>)  <span class="hljs-comment"># 信道增益</span><br>    trans_rate = self.B * math.log2(<span class="hljs-number">1</span> + self.p_uplink * g_uav_ue / p_noise)  <span class="hljs-comment"># 上行链路传输速率bps</span><br>    t_tr = offloading_ratio * task_size / trans_rate  <span class="hljs-comment"># 上传时延,1B=8bit</span><br>    t_edge_com = offloading_ratio * task_size / (self.f_uav / self.s)  <span class="hljs-comment"># 在UAV边缘服务器上计算时延</span><br>    t_local_com = (<span class="hljs-number">1</span> - offloading_ratio) * task_size / (self.f_ue / self.s)  <span class="hljs-comment"># 本地计算时延</span><br>    <span class="hljs-comment"># 比较上传到服务器的时间和本地计算的时间，时延越长，返回的值越高</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>([t_tr + t_edge_com, t_local_com])<br></code></pre></td></tr></table></figure><h3 id="62-状态标准化"><a class="markdownIt-Anchor" href="#62-状态标准化"></a> 6.2 状态标准化</h3><p>使用状态归一化算法对观测状态进行预处理，从而更有效地训练 DNN 。该算法将每个变量的最大值与最小值之差作为尺度因子。所提出的状态归一化算法可以很好地解决输入变量的大小差异问题。</p><p>在我们的工作中，变量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mtext>battery </mtext></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="bold">q</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi mathvariant="bold">p</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi mathvariant="bold">p</mi><mi>K</mi></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>D</mi><mtext>remain </mtext></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>D</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>D</mi><mrow><mi>K</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E_{\text {battery }}(i), \mathbf{q}(i), \mathbf{p}_{1}(i), \ldots, \mathbf{p}_{K}(i), D_{\text {remain }}(i), D_{1}(i), \ldots, D_{K-1}(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">battery </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathbf">q</span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner">…</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.07153em">K</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31750199999999995em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">remain </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner">…</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.328331em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.07153em">K</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mrow><mi>K</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D_{K-1}(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.328331em"><span style="top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.07153em">K</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span> 在状态集中处于不同的序列，这可能导致在训练中出现问题。如算法 1 所示，通过状态归一化对这些变量进行归一化，以防止出现这种问题。在状态归一化算法中，我们使用了五个尺度因子。每个因素可以解释如下。利用缩放因子 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">\gamma_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05556em">γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:-.05556em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 来缩小无人机电池容量。由于 UAV 和 UE 具有相同的 x 和 y 坐标范围，我们使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">\gamma_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05556em">γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.05556em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">\gamma_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.716668em;vertical-align:-.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05556em">γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-.05556em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span> 分别缩小UAV和UE的x和y坐标。我们使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><msub><mi>D</mi><mrow><mi>r</mi><mi>m</mi></mrow></msub></msub></mrow><annotation encoding="application/x-tex">\gamma_{D_{rm}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68066em;vertical-align:-.2501em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05556em">γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-left:-.05556em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.16454285714285719em"><span style="top:-2.357em;margin-left:-.02778em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span></span></span></span> 来缩小整个时间段内剩余的任务，使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><msub><mi>D</mi><mrow><mi>U</mi><mi>E</mi></mrow></msub></msub></mrow><annotation encoding="application/x-tex">\gamma_{D_{UE}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.680865em;vertical-align:-.250305em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05556em">γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-left:-.05556em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.3567071428571427em;margin-left:-.02778em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.10903em">U</span><span class="mord mathnormal mtight" style="margin-right:.05764em">E</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.14329285714285717em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.250305em"><span></span></span></span></span></span></span></span></span></span> 来缩小时间段 i 内每个终端的任务大小。</p><p><img src="https://raw.githubusercontent.com/fulequn/oss_img/master/img221/202201211736297.png" srcset="/img/loading.gif" lazyload alt="2"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> UAV_env <span class="hljs-keyword">import</span> UAVEnv<br><br>env = UAVEnv()<br>M = env.M<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StateNormalization</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    状态标准化类</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.high_state = np.array(<br>            [<span class="hljs-number">5e5</span>, env.ground_length, env.ground_width, <span class="hljs-number">100</span> * <span class="hljs-number">1048576</span>])<br>        self.high_state = np.append(self.high_state, np.ones(M * <span class="hljs-number">2</span>) * env.ground_length)<br>        self.high_state = np.append(self.high_state, np.ones(M) * <span class="hljs-number">3145728</span>)<br>        self.high_state = np.append(self.high_state, np.ones(M))<br>        self.low_state = np.zeros(<span class="hljs-number">20</span>)  <span class="hljs-comment"># uav loc, ue loc, task size, block_flag</span><br>        self.low_state[<span class="hljs-built_in">len</span>(self.low_state) - <span class="hljs-number">2</span> * M:<span class="hljs-built_in">len</span>(self.low_state) - M] = np.ones(M) * <span class="hljs-number">2621440</span><br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">state_normal</span>(<span class="hljs-params">self, state</span>):<br>        state[<span class="hljs-built_in">len</span>(state) - <span class="hljs-number">2</span> * M: <span class="hljs-built_in">len</span>(state) - M] -= <span class="hljs-number">2621440</span><br>        res = state / (self.high_state - self.low_state)<br>        <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure><h3 id="63-强化学习类"><a class="markdownIt-Anchor" href="#63-强化学习类"></a> 6.3 强化学习类</h3><p>这里使用自己想要的强化学习类来完成对应的策略选择。以DQN为例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Deep Q Network off-policy</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepQNetwork</span>:<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"></span><br><span class="hljs-params">            self,</span><br><span class="hljs-params">            n_actions,</span><br><span class="hljs-params">            n_features,</span><br><span class="hljs-params">            learning_rate=<span class="hljs-number">0.1</span>,</span><br><span class="hljs-params">            reward_decay=<span class="hljs-number">0.001</span>,</span><br><span class="hljs-params">            e_greedy=<span class="hljs-number">0.99</span>,</span><br><span class="hljs-params">            replace_target_iter=<span class="hljs-number">200</span>,</span><br><span class="hljs-params">            memory_size=MEMORY_CAPACITY,</span><br><span class="hljs-params">            batch_size=BATCH_SIZE,</span><br><span class="hljs-params">            <span class="hljs-comment"># e_greedy_increment=8.684615e-05,</span></span><br><span class="hljs-params">            output_graph=<span class="hljs-literal">False</span>,</span><br><span class="hljs-params">    </span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        初始化DQN网络</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Parameters</span><br><span class="hljs-string">        ----------</span><br><span class="hljs-string">        n_actions : TYPE</span><br><span class="hljs-string">            行为空间大小</span><br><span class="hljs-string">        n_features : TYPE</span><br><span class="hljs-string">            环境特征</span><br><span class="hljs-string">        learning_rate : TYPE, optional</span><br><span class="hljs-string">            学习率. The default is 0.1.</span><br><span class="hljs-string">        reward_decay : TYPE, optional</span><br><span class="hljs-string">            奖励衰减因子. The default is 0.001.</span><br><span class="hljs-string">        e_greedy : TYPE, optional</span><br><span class="hljs-string">            e贪心因子. The default is 0.99.</span><br><span class="hljs-string">        replace_target_iter : TYPE, optional</span><br><span class="hljs-string">            每多少次更新target参数. The default is 200.</span><br><span class="hljs-string">        memory_size : TYPE, optional</span><br><span class="hljs-string">            记忆库大小. The default is MEMORY_CAPACITY.</span><br><span class="hljs-string">        batch_size : TYPE, optional</span><br><span class="hljs-string">            批处理大小. The default is BATCH_SIZE.</span><br><span class="hljs-string">        # e_greedy_increment : TYPE, optional</span><br><span class="hljs-string">            e贪心因子增长幅度. The default is 8.684615e-05.</span><br><span class="hljs-string">        output_graph : TYPE, optional</span><br><span class="hljs-string">            是否输出图表. The default is False.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Returns</span><br><span class="hljs-string">        -------</span><br><span class="hljs-string">        None.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        self.n_actions = n_actions<br>        self.n_features = n_features<br>        self.lr = learning_rate<br>        self.gamma = reward_decay<br>        self.epsilon_max = e_greedy<br>        self.replace_target_iter = replace_target_iter<br>        self.memory_size = memory_size<br>        self.batch_size = batch_size<br>        <span class="hljs-comment"># self.epsilon_increment = e_greedy_increment</span><br>        <span class="hljs-comment"># self.epsilon = 0 if e_greedy_increment is not None else self.epsilon_max</span><br>        self.epsilon = <span class="hljs-number">0.99</span><br><br>        <span class="hljs-comment"># total learning step</span><br>        self.learn_step_counter = <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># initialize zero memory [s, a, r, s_]</span><br>        <span class="hljs-comment"># 初始化记忆库</span><br>        self.memory = np.zeros((MEMORY_CAPACITY, s_dim * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>), dtype=np.float32)  <span class="hljs-comment"># memory里存放当前和下一个state，动作和奖励</span><br><br>        <span class="hljs-comment"># consist of [target_net, evaluate_net]</span><br>        <span class="hljs-comment"># 构建神经网络</span><br>        self._build_net()<br><br>        <span class="hljs-comment"># tf.get_collection()：从一个集合中取出变量 </span><br>        <span class="hljs-comment"># tf.GraphKeys 包含所有graph collection中的标准集合名</span><br>        <span class="hljs-comment"># tf.GraphKeys.GLOBAL_VARIABLES 则应该是所有的图变量的集合</span><br>        t_params = tf.get_collection(tf.GraphKeys.GLOBAL_VARIABLES, scope=<span class="hljs-string">&#x27;target_net&#x27;</span>)<br>        e_params = tf.get_collection(tf.GraphKeys.GLOBAL_VARIABLES, scope=<span class="hljs-string">&#x27;eval_net&#x27;</span>)<br><br>        <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&#x27;hard_replacement&#x27;</span>):<br>            self.target_replace_op = [tf.assign(t, e) <span class="hljs-keyword">for</span> t, e <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(t_params, e_params)]<br><br>        self.sess = tf.Session()<br><br>        <span class="hljs-keyword">if</span> output_graph:<br>            <span class="hljs-comment"># $ tensorboard --logdir=logs</span><br>            tf.summary.FileWriter(<span class="hljs-string">&quot;logs/&quot;</span>, self.sess.graph)<br>        <br>        <span class="hljs-comment"># 全局变量初始化</span><br>        self.sess.run(tf.global_variables_initializer())<br>        self.cost_his = []<br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_build_net</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        构建所有的网络图</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Returns</span><br><span class="hljs-string">        -------</span><br><span class="hljs-string">        None.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        <span class="hljs-comment"># ------------------ all inputs ------------------------</span><br>        self.s = tf.placeholder(tf.float32, [<span class="hljs-literal">None</span>, self.n_features], name=<span class="hljs-string">&#x27;s&#x27;</span>)  <span class="hljs-comment"># input State</span><br>        self.s_ = tf.placeholder(tf.float32, [<span class="hljs-literal">None</span>, self.n_features], name=<span class="hljs-string">&#x27;s_&#x27;</span>)  <span class="hljs-comment"># input Next State</span><br>        self.r = tf.placeholder(tf.float32, [<span class="hljs-literal">None</span>, ], name=<span class="hljs-string">&#x27;r&#x27;</span>)  <span class="hljs-comment"># input Reward</span><br>        self.a = tf.placeholder(tf.int32, [<span class="hljs-literal">None</span>, ], name=<span class="hljs-string">&#x27;a&#x27;</span>)  <span class="hljs-comment"># input Action</span><br>        <br>        <span class="hljs-comment"># 满足正态分布</span><br>        w_initializer, b_initializer = tf.random_normal_initializer(<span class="hljs-number">0.</span>, <span class="hljs-number">0.3</span>), tf.constant_initializer(<span class="hljs-number">0.1</span>)<br>        <span class="hljs-comment"># ------------------ build evaluate_net ------------------</span><br>        <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&#x27;eval_net&#x27;</span>):<br>            <span class="hljs-comment"># tf.layers.dense()：添加一个全连接层</span><br>            <span class="hljs-comment"># tf.nn.relu6：计算校正线性6：min(max(features, 0), 6)</span><br>            e1 = tf.layers.dense(self.s, <span class="hljs-number">100</span>, tf.nn.relu6, kernel_initializer=w_initializer,<br>                                 bias_initializer=b_initializer, name=<span class="hljs-string">&#x27;e1&#x27;</span>)<br>            <span class="hljs-comment"># e2 = tf.layers.dense(e1, 48, tf.nn.relu6, kernel_initializer=w_initializer,</span><br>            <span class="hljs-comment">#                      bias_initializer=b_initializer, name=&#x27;e2&#x27;)</span><br>            e3 = tf.layers.dense(e1, <span class="hljs-number">20</span>, tf.nn.relu, kernel_initializer=w_initializer,<br>                                 bias_initializer=b_initializer, name=<span class="hljs-string">&#x27;e3&#x27;</span>)<br>            self.q_eval = tf.layers.dense(e3, self.n_actions, tf.nn.softmax, kernel_initializer=w_initializer,<br>                                          bias_initializer=b_initializer, name=<span class="hljs-string">&#x27;q&#x27;</span>)<br><br>        <span class="hljs-comment"># ------------------ build target_net ------------------</span><br>        <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&#x27;target_net&#x27;</span>):<br>            t1 = tf.layers.dense(self.s_, <span class="hljs-number">100</span>, tf.nn.relu6, kernel_initializer=w_initializer,<br>                                 bias_initializer=b_initializer, name=<span class="hljs-string">&#x27;t1&#x27;</span>)<br>            <span class="hljs-comment"># t2 = tf.layers.dense(t1, 48, tf.nn.relu6, kernel_initializer=w_initializer,</span><br>            <span class="hljs-comment">#                      bias_initializer=b_initializer, name=&#x27;t2&#x27;)</span><br>            t3 = tf.layers.dense(t1, <span class="hljs-number">20</span>, tf.nn.relu, kernel_initializer=w_initializer,<br>                                 bias_initializer=b_initializer, name=<span class="hljs-string">&#x27;t3&#x27;</span>)<br>            self.q_next = tf.layers.dense(t3, self.n_actions, tf.nn.softmax, kernel_initializer=w_initializer,<br>                                          bias_initializer=b_initializer, name=<span class="hljs-string">&#x27;t4&#x27;</span>)<br><br>        <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&#x27;q_target&#x27;</span>):<br>            q_target = self.r + self.gamma * tf.reduce_max(self.q_next, axis=<span class="hljs-number">1</span>, name=<span class="hljs-string">&#x27;Qmax_s_&#x27;</span>)  <span class="hljs-comment"># shape=(None, )</span><br>            self.q_target = tf.stop_gradient(q_target)<br>        <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&#x27;q_eval&#x27;</span>):<br>            a_indices = tf.stack([tf.<span class="hljs-built_in">range</span>(tf.shape(self.a)[<span class="hljs-number">0</span>], dtype=tf.int32), self.a], axis=<span class="hljs-number">1</span>)<br>            self.q_eval_wrt_a = tf.gather_nd(params=self.q_eval, indices=a_indices)  <span class="hljs-comment"># shape=(None, )</span><br>        <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&#x27;loss&#x27;</span>):<br>            self.loss = tf.reduce_mean(tf.squared_difference(self.q_target, self.q_eval_wrt_a, name=<span class="hljs-string">&#x27;TD_error&#x27;</span>))<br>        <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&#x27;train&#x27;</span>):<br>            <span class="hljs-comment"># self._train_op = tf.train.RMSPropOptimizer(self.lr).minimize(self.loss)</span><br>            self._train_op = tf.train.AdamOptimizer(self.lr).minimize(self.loss)<br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">store_transition</span>(<span class="hljs-params">self, s, a, r, s_</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        存储记忆元组</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Parameters</span><br><span class="hljs-string">        ----------</span><br><span class="hljs-string">        s : 当前状态</span><br><span class="hljs-string">        a : 动作</span><br><span class="hljs-string">        r : 奖惩</span><br><span class="hljs-string">        s_ : 下一状态</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Returns</span><br><span class="hljs-string">        -------</span><br><span class="hljs-string">        None.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">hasattr</span>(self, <span class="hljs-string">&#x27;memory_counter&#x27;</span>):<br>            self.memory_counter = <span class="hljs-number">0</span><br>        <span class="hljs-comment"># np.hstack将参数元组的元素数组按水平方向进行叠加</span><br>        transition = np.hstack((s, a, [r], s_))<br>        <span class="hljs-comment"># replace the old memory with new memory</span><br>        index = self.memory_counter % self.memory_size<br>        self.memory[index, :] = transition<br>        self.memory_counter += <span class="hljs-number">1</span><br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">choose_action</span>(<span class="hljs-params">self, observation</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        根据当前状态选择动作</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Parameters</span><br><span class="hljs-string">        ----------</span><br><span class="hljs-string">        observation : 对环境的观测</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Returns</span><br><span class="hljs-string">        -------</span><br><span class="hljs-string">        action : 做出的动作</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        <span class="hljs-comment"># to have batch dimension when feed into tf placeholder</span><br>        <span class="hljs-comment"># 环境状态</span><br>        observation = observation[np.newaxis, :]<br>        <br>        <span class="hljs-comment"># e贪心算法</span><br>        <span class="hljs-keyword">if</span> np.random.uniform() &lt; self.epsilon:<br>            <span class="hljs-comment"># forward feed the observation and get q value for every actions</span><br>            actions_value = self.sess.run(self.q_eval, feed_dict=&#123;self.s: observation&#125;)<br>            action = np.argmax(actions_value)<br>        <span class="hljs-keyword">else</span>:<br>            action = np.random.randint(<span class="hljs-number">0</span>, self.n_actions)<br>        <span class="hljs-keyword">return</span> action<br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">learn</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        神经网络训练</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Returns</span><br><span class="hljs-string">        -------</span><br><span class="hljs-string">        None.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        <span class="hljs-comment"># check to replace target parameters</span><br>        <span class="hljs-keyword">if</span> self.learn_step_counter % self.replace_target_iter == <span class="hljs-number">0</span>:<br>            self.sess.run(self.target_replace_op)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\ntarget_params_replaced\n&#x27;</span>)<br><br>        <span class="hljs-comment"># sample batch memory from all memory</span><br>        <span class="hljs-comment"># 从所有记忆中选取小批量记忆</span><br>        <span class="hljs-keyword">if</span> self.memory_counter &gt; self.memory_size:<br>            sample_index = np.random.choice(self.memory_size, size=self.batch_size)<br>        <span class="hljs-keyword">else</span>:<br>            sample_index = np.random.choice(self.memory_counter, size=self.batch_size)<br>        batch_memory = self.memory[sample_index, :]<br><br>        _, cost = self.sess.run(<br>            [self._train_op, self.loss],<br>            feed_dict=&#123;<br>                self.s: batch_memory[:, :self.n_features],<br>                self.a: batch_memory[:, self.n_features],<br>                self.r: batch_memory[:, self.n_features + <span class="hljs-number">1</span>],<br>                self.s_: batch_memory[:, -self.n_features:],<br>            &#125;)<br><br>        self.cost_his.append(cost)<br><br>        <span class="hljs-comment"># increasing epsilon</span><br>        <span class="hljs-comment"># self.epsilon = self.epsilon + self.epsilon_increment if self.epsilon &lt; self.epsilon_max else self.epsilon_max</span><br>        self.learn_step_counter += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="category-chain-item">人工智能</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E8%AE%BA%E6%96%87/" class="print-no-link">#论文</a></div></div><div class="license-box my-3"><div class="license-title"><div>无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（6）——代码实现</div><div>https://fulequn.github.io/2022/01/Article202201211/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Fulequn</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年1月21日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/02/Article202202121/" title="无人机辅助车载网络的深度强化学习"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">无人机辅助车载网络的深度强化学习</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/01/Article202201181/" title="无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（5）——结果与分析"><span class="hidden-mobile">无人机辅助移动边缘计算的计算卸载优化:一种深度确定性策略梯度方法（5）——结果与分析</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>